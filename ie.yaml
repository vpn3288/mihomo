# ====== è®¢é˜…é“¾æ¥ ======
sub_edge: &edge_sub "C%E4%BA%AC"
sub_chrome: &chrome_sub "%89%E7%9F%B6-CN2"
sub_firefox: &firefox_sub "E7%9F%B6"
sub_brave: &brave_sub "87%A4%E5%87%B0%E5%9F%8E-1"

# ====== åŸºç¡€ç½‘ç»œé…ç½® ======
port: 7890
socks-port: 7891
mixed-port: 7892
redir-port: 7893
tproxy-port: 7894
allow-lan: false
bind-address: "127.0.0.1"
mode: rule
log-level: warning
ipv6: true
udp: true
tcp-concurrent: true
find-process-mode: strict
global-client-fingerprint: chrome
unified-delay: true

# ====== Smartæ ¸å¿ƒåŠŸèƒ½ ======
smart:
  enable: true
  interval: 1800          # Smartè®­ç»ƒé—´éš”(ç§’)ï¼Œ30åˆ†é’Ÿ
  tolerance: 20           # åŒIPå¤šåè®®ï¼Œå»¶è¿Ÿå·®å¼‚å°ï¼Œé™ä½å®¹å¿åº¦
  strategy: consistency   # ç­–ç•¥: latency(æœ€ä½å»¶è¿Ÿ) | consistency(ä¸€è‡´æ€§) | smart(æ™ºèƒ½)
  only-effect-groups:     # åªå¯¹æŒ‡å®šä»£ç†ç»„ç”Ÿæ•ˆ
    - "ğŸ” Edgeæ™ºèƒ½"
    - "ğŸŸ¢ Chromeæ™ºèƒ½" 
    - "ğŸ¦Š Firefoxæ™ºèƒ½"
    - "ğŸ¦ Braveæ™ºèƒ½"
    - "â™»ï¸ åè®®æ™ºé€‰"
  bypass-failed-nodes: true    # ç»•è¿‡å¤±æ•ˆèŠ‚ç‚¹
  max-failed-times: 2         # åŒIPèŠ‚ç‚¹ï¼Œé™ä½å¤±è´¥å®¹å¿æ¬¡æ•°
  auto-detect-interface: true  # è‡ªåŠ¨æ£€æµ‹ç½‘ç»œæ¥å£

# ====== å¤–éƒ¨æ§åˆ¶ ======
external-controller: 127.0.0.1:9090
secret: "S3cureP@ssw0rd"
external-ui: ui

# ====== DNSé…ç½® ======
dns:
  enable: true
  listen: 0.0.0.0:1053
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:
    - '*.lan'
    - '*.local'
    - localhost.ptlogin2.qq.com
    - '+.srv.nintendo.net'
    - '+.stun.playstation.net'
    - '+.msftconnecttest.com'
    - '+.msftncsi.com'
    - '+.xboxlive.com'
  use-system-hosts: true
  default-nameserver:
    - 1.1.1.1
    - 8.8.8.8
    - 223.5.5.5
  nameserver:
    - "https://cloudflare-dns.com/dns-query"
    - "https://dns.google/dns-query"
    - "https://doh.pub/dns-query"
  proxy-server-nameserver:
    - "https://1.1.1.1/dns-query"
    - "https://8.8.8.8/dns-query"
  nameserver-policy:
    "geosite:cn,private":
      - "https://doh.pub/dns-query"
      - "https://dns.alidns.com/dns-query"
    "geosite:geolocation-!cn":
      - "https://dns.cloudflare.com/dns-query"
      - "https://dns.google/dns-query"

# ====== è®¢é˜…æä¾›è€… ======
proxy-providers:
  Edge:
    type: http
    url: *edge_sub
    interval: 3600
    path: ./providers/edge.yaml
    health-check:
      enable: true
      url: https://www.gstatic.com/generate_204
      interval: 300
      timeout: 3000
      
  Chrome:
    type: http
    url: *chrome_sub
    interval: 3600
    path: ./providers/chrome.yaml
    health-check:
      enable: true
      url: https://www.gstatic.com/generate_204
      interval: 300
      timeout: 3000
      
  Firefox:
    type: http
    url: *firefox_sub
    interval: 3600
    path: ./providers/firefox.yaml
    health-check:
      enable: true
      url: https://www.gstatic.com/generate_204
      interval: 300
      timeout: 3000
      
  Brave:
    type: http
    url: *brave_sub
    interval: 3600
    path: ./providers/brave.yaml
    health-check:
      enable: true
      url: https://www.gstatic.com/generate_204
      interval: 300
      timeout: 3000

# ====== ä»£ç†ç»„é…ç½® ======
proxy-groups:
  # ä¸»é€‰æ‹©ç»„ - é’ˆå¯¹åŒIPå¤šåè®®ä¼˜åŒ–
  - name: "ğŸŒ ä»£ç†é€‰æ‹©"
    type: select
    proxies:
      - "â™»ï¸ åè®®æ™ºé€‰"      # Smarté€‰æ‹©æœ€ä¼˜åè®®
      - "ğŸ›¡ï¸ åè®®å®¹ç¾"      # å®¹ç¾å¤‡ç”¨
      - "ğŸ”„ åè®®è½®æ¢"      # è½®æ¢ä½¿ç”¨åè®®
      - "ğŸ” Edgeä»£ç†"      # VMessåè®®
      - "ğŸŸ¢ Chromeä»£ç†"    # å…¶ä»–åè®®...
      - "ğŸ¦Š Firefoxä»£ç†"
      - "ğŸ¦ Braveä»£ç†"
      - "ğŸš« ç›´è¿"

  # Edgeæµè§ˆå™¨ä»£ç†ç»„ - Smartæ™ºèƒ½ + ç›´æ¥æ‰‹åŠ¨é€‰æ‹©
  - name: "ğŸ” Edgeä»£ç†"
    type: select
    proxies:
      - "ğŸ” Edgeæ™ºèƒ½"      # Smartè‡ªåŠ¨é€‰æ‹©
    use: [Edge]            # åŒæ—¶åŒ…å«æ‰€æœ‰EdgeèŠ‚ç‚¹ä¾›æ‰‹åŠ¨é€‰æ‹©
    
  - name: "ğŸ” Edgeæ™ºèƒ½"
    type: url-test
    use: [Edge]
    url: https://www.gstatic.com/generate_204
    interval: 180
    timeout: 2000
    tolerance: 20
    lazy: true
    strategy: smart
    max-failed-times: 2
    expected-status: "200"
    
  # Chromeæµè§ˆå™¨ä»£ç†ç»„ - Smartæ™ºèƒ½ + ç›´æ¥æ‰‹åŠ¨é€‰æ‹©
  - name: "ğŸŸ¢ Chromeä»£ç†"
    type: select
    proxies:
      - "ğŸŸ¢ Chromeæ™ºèƒ½"     # Smartè‡ªåŠ¨é€‰æ‹©
    use: [Chrome]           # åŒæ—¶åŒ…å«æ‰€æœ‰ChromeèŠ‚ç‚¹ä¾›æ‰‹åŠ¨é€‰æ‹©
    
  - name: "ğŸŸ¢ Chromeæ™ºèƒ½"
    type: url-test
    use: [Chrome]
    url: https://www.gstatic.com/generate_204
    interval: 180
    timeout: 2000
    tolerance: 20
    lazy: true
    strategy: smart
    max-failed-times: 2
    expected-status: "200"
    
  # Firefoxæµè§ˆå™¨ä»£ç†ç»„ - Smartæ™ºèƒ½ + ç›´æ¥æ‰‹åŠ¨é€‰æ‹©
  - name: "ğŸ¦Š Firefoxä»£ç†"
    type: select
    proxies:
      - "ğŸ¦Š Firefoxæ™ºèƒ½"    # Smartè‡ªåŠ¨é€‰æ‹©
    use: [Firefox]          # åŒæ—¶åŒ…å«æ‰€æœ‰FirefoxèŠ‚ç‚¹ä¾›æ‰‹åŠ¨é€‰æ‹©
    
  - name: "ğŸ¦Š Firefoxæ™ºèƒ½"
    type: url-test
    use: [Firefox]
    url: https://www.gstatic.com/generate_204
    interval: 180
    timeout: 2000
    tolerance: 20
    lazy: true
    strategy: smart
    max-failed-times: 2
    expected-status: "200"
    
  # Braveæµè§ˆå™¨ä»£ç†ç»„ - Smartæ™ºèƒ½ + ç›´æ¥æ‰‹åŠ¨é€‰æ‹©
  - name: "ğŸ¦ Braveä»£ç†"
    type: select
    proxies:
      - "ğŸ¦ Braveæ™ºèƒ½"      # Smartè‡ªåŠ¨é€‰æ‹©
    use: [Brave]            # åŒæ—¶åŒ…å«æ‰€æœ‰BraveèŠ‚ç‚¹ä¾›æ‰‹åŠ¨é€‰æ‹©
    
  - name: "ğŸ¦ Braveæ™ºèƒ½"
    type: url-test
    use: [Brave]
    url: https://www.gstatic.com/generate_204
    interval: 180
    timeout: 2000
    tolerance: 20
    lazy: true
    strategy: smart
    max-failed-times: 2
    expected-status: "200"

  # æ‰‹åŠ¨é€‰æ‹©ç»„ - å·²æ•´åˆåˆ°å„æµè§ˆå™¨ä»£ç†ç»„ä¸­ï¼Œåˆ é™¤å†—ä½™ç»„

  # è‡ªåŠ¨é€‰æ‹©ç»„ - åŒIPå¤šåè®®Smartæ™ºèƒ½é€‰æ‹©æœ€ä¼˜åè®®
  - name: "â™»ï¸ åè®®æ™ºé€‰"
    type: url-test
    use: [Edge, Chrome, Firefox, Brave]
    url: https://www.gstatic.com/generate_204
    interval: 180           # åŒIPèŠ‚ç‚¹ï¼Œæé«˜æ£€æµ‹é¢‘ç‡
    timeout: 2000          # é™ä½è¶…æ—¶æ—¶é—´
    tolerance: 20          # åŒIPå»¶è¿Ÿå·®å¼‚å°
    lazy: true
    strategy: smart        # Smartä¼šé€‰æ‹©æœ€ç¨³å®šçš„åè®®
    max-failed-times: 2
    expected-status: "200"

  # åè®®å®¹ç¾ç»„ - fallbackç¡®ä¿è‡³å°‘æœ‰ä¸€ä¸ªåè®®å¯ç”¨
  - name: "ğŸ›¡ï¸ åè®®å®¹ç¾"
    type: fallback
    use: [Edge, Chrome, Firefox, Brave]
    url: https://www.gstatic.com/generate_204
    interval: 120          # æ›´é¢‘ç¹çš„å¥åº·æ£€æŸ¥
    timeout: 2000
    lazy: true

  # å–æ¶ˆä¼ ç»Ÿè´Ÿè½½å‡è¡¡ï¼ˆåŒIPæ— æ„ä¹‰ï¼‰
  # æ”¹ä¸ºåè®®è½®æ¢ - é˜²æ­¢å•ä¸€åè®®è¿‡è½½
  - name: "ğŸ”„ åè®®è½®æ¢"
    type: load-balance
    use: [Edge, Chrome, Firefox, Brave]
    url: https://www.gstatic.com/generate_204
    interval: 180
    timeout: 2000
    strategy: round-robin   # è½®æ¢ä½¿ç”¨ä¸åŒåè®®
    lazy: true

  # ç‰¹æ®Šç”¨é€”ä»£ç†ç»„
  - name: "ğŸ“º æµåª’ä½“"
    type: select
    proxies:
      - "â™»ï¸ åè®®æ™ºé€‰"      # Smarté€‰æ‹©æœ€ä½³åè®®
      - "ğŸŸ¢ Chromeæ™ºèƒ½"    # æ‰‹åŠ¨æŒ‡å®šåè®®
      - "ğŸ” Edgeæ™ºèƒ½"
      - "ğŸ¦Š Firefoxæ™ºèƒ½"
      - "ğŸ¦ Braveæ™ºèƒ½"
      - "ğŸ›¡ï¸ åè®®å®¹ç¾"

  - name: "ğŸ“± ç”µæŠ¥"
    type: select
    proxies:
      - "â™»ï¸ åè®®æ™ºé€‰"
      - "ğŸ”„ åè®®è½®æ¢"      # ç”µæŠ¥å¯ä»¥è½®æ¢åè®®
      - "ğŸŸ¢ Chromeæ™ºèƒ½"
      - "ğŸ” Edgeæ™ºèƒ½"
      - "ğŸ¦Š Firefoxæ™ºèƒ½" 
      - "ğŸ¦ Braveæ™ºèƒ½"

  - name: "ğŸ® æ¸¸æˆ"
    type: select
    proxies:
      - "ğŸš« ç›´è¿"
      - "â™»ï¸ åè®®æ™ºé€‰"      # æ¸¸æˆé€‰æ‹©æœ€ç¨³å®šåè®®
      - "ğŸ›¡ï¸ åè®®å®¹ç¾"
      - "ğŸŸ¢ Chromeæ™ºèƒ½"

  - name: "ğŸ è‹¹æœæœåŠ¡"
    type: select
    proxies:
      - "ğŸš« ç›´è¿"
      - "â™»ï¸ åè®®æ™ºé€‰"
      - "ğŸŸ¢ Chromeæ™ºèƒ½"

  - name: "ğŸ“¢ å¹¿å‘Šæ‹¦æˆª"
    type: select
    proxies:
      - "ğŸ›¡ï¸ æ‹¦æˆª"
      - "ğŸš« ç›´è¿"

  - name: "ğŸš« ç›´è¿"
    type: select
    proxies:
      - DIRECT

  - name: "ğŸ›¡ï¸ æ‹¦æˆª"
    type: select
    proxies:
      - REJECT

# ====== è§„åˆ™é…ç½® ======
rules:
  # åº”ç”¨ç¨‹åºåˆ†æµè§„åˆ™ï¼ˆWindowsï¼‰
  - PROCESS-NAME,msedge.exe,ğŸ” Edgeä»£ç†
  - PROCESS-NAME,chrome.exe,ğŸŸ¢ Chromeä»£ç†
  - PROCESS-NAME,firefox.exe,ğŸ¦Š Firefoxä»£ç†
  - PROCESS-NAME,brave.exe,ğŸ¦ Braveä»£ç†
  
  # Androidåº”ç”¨åˆ†æµï¼ˆéœ€è¦å¼€å¯å¢å¼ºæ¨¡å¼ï¼‰
  - PROCESS-NAME,com.android.chrome,ğŸŸ¢ Chromeä»£ç†
  - PROCESS-NAME,com.microsoft.emmx,ğŸ” Edgeä»£ç†
  - PROCESS-NAME,org.mozilla.firefox,ğŸ¦Š Firefoxä»£ç†
  - PROCESS-NAME,com.brave.browser,ğŸ¦ Braveä»£ç†
  
  # å¹¿å‘Šæ‹¦æˆª
  - GEOSITE,category-ads-all,ğŸ“¢ å¹¿å‘Šæ‹¦æˆª
  
  # æµåª’ä½“æœåŠ¡
  - GEOSITE,youtube,ğŸ“º æµåª’ä½“
  - GEOSITE,netflix,ğŸ“º æµåª’ä½“
  - GEOSITE,disney,ğŸ“º æµåª’ä½“
  - GEOSITE,hbo,ğŸ“º æµåª’ä½“
  - GEOSITE,primevideo,ğŸ“º æµåª’ä½“
  
  # ç¤¾äº¤åª’ä½“
  - GEOSITE,telegram,ğŸ“± ç”µæŠ¥
  - GEOSITE,twitter,ğŸŒ ä»£ç†é€‰æ‹©
  - GEOSITE,facebook,ğŸŒ ä»£ç†é€‰æ‹©
  - GEOSITE,instagram,ğŸŒ ä»£ç†é€‰æ‹©
  
  # æ¸¸æˆç›¸å…³ï¼ˆä½¿ç”¨åŸŸåè§„åˆ™ä»£æ›¿ï¼Œå› ä¸ºGEOSITEæ— ä¸“é—¨æ¸¸æˆè§„åˆ™ï¼‰
  - DOMAIN-SUFFIX,steampowered.com,ğŸ® æ¸¸æˆ
  - DOMAIN-SUFFIX,steamcommunity.com,ğŸ® æ¸¸æˆ
  - DOMAIN-SUFFIX,steamstatic.com,ğŸ® æ¸¸æˆ
  - DOMAIN-SUFFIX,epicgames.com,ğŸ® æ¸¸æˆ
  - DOMAIN-SUFFIX,unrealengine.com,ğŸ® æ¸¸æˆ
  - DOMAIN-SUFFIX,nintendo.com,ğŸ® æ¸¸æˆ
  - DOMAIN-SUFFIX,nintendo.net,ğŸ® æ¸¸æˆ
  - DOMAIN-SUFFIX,origin.com,ğŸ® æ¸¸æˆ
  - DOMAIN-SUFFIX,ea.com,ğŸ® æ¸¸æˆ
  - DOMAIN-SUFFIX,ubisoft.com,ğŸ® æ¸¸æˆ
  - DOMAIN-SUFFIX,battle.net,ğŸ® æ¸¸æˆ
  - DOMAIN-SUFFIX,blizzard.com,ğŸ® æ¸¸æˆ
  
  # è‹¹æœæœåŠ¡
  - GEOSITE,apple,ğŸ è‹¹æœæœåŠ¡
  - GEOSITE,icloud,ğŸ è‹¹æœæœåŠ¡
  
  # è°·æ­ŒæœåŠ¡
  - GEOSITE,google,ğŸŸ¢ Chromeä»£ç†
  - GEOSITE,youtube,ğŸ“º æµåª’ä½“
  
  # MicrosoftæœåŠ¡
  - GEOSITE,microsoft,ğŸ” Edgeä»£ç†
  
  # å›½å¤–ç½‘ç«™
  - GEOSITE,geolocation-!cn,ğŸŒ ä»£ç†é€‰æ‹©
  
  # å›½å†…ç½‘ç«™ç›´è¿
  - GEOSITE,cn,ğŸš« ç›´è¿
  - GEOSITE,private,ğŸš« ç›´è¿
  
  # å›½å†…IPç›´è¿
  - GEOIP,CN,ğŸš« ç›´è¿
  - GEOIP,private,ğŸš« ç›´è¿
  
  # æœ€ç»ˆè§„åˆ™
  - MATCH,ğŸŒ ä»£ç†é€‰æ‹©
